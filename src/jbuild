(jbuild_version 1)

(ocamllex (reason_lexer))

; Previously, make preprocess.
(rule
 ((targets (reason_parser.cmly reason_parser.ml reason_parser.mli))
  (deps (reason_parser.mly))
  (action
   (run menhir --unused-tokens --fixed-exception --table --cmly reason_parser.mly))))

(executables
 ((names (menhir_error_processor))
  (modules menhir_error_processor)
  (libraries (unix menhirSdk))))

(rule
 ((targets (reason_parser_explain_raw.ml))
  (deps ( reason_parser.cmly))
  (action
   (with-stdout-to ${@} (run ./menhir_error_processor.exe reason_parser.cmly)))))

; Previously, make compiler_error
(rule
 ((targets (reason_parser_message.ml))
  (deps (reason_parser.mly reason_parser.messages.checked-in))
  (action
   (with-stdout-to ${@} (run menhir --explain --unused-tokens reason_parser.mly --compile-errors reason_parser.messages.checked-in)))))

(library
 ((name imandra_reason_parser)
; Uncomment to allow make coverage target to work
; requires you to have run $ opam install bisect_ppx
;  (preprocess (pps (bisect_ppx)))
  (public_name imandra-reason-parser)
  (wrapped true)
  (modules
   (lexer_warning
    plugin
    reason_syntax_util
    reason_comment
    reason_layout
    reason_heuristics
    reason_location
    reason_toolchain
    reason_config
    reason_pprint_ast
    reason_parser
    reason_lexer
    reason_parser_message
    reason_oprint
    reason_parser_explain_raw
    reason_parser_explain))
  (libraries
   (ocaml-migrate-parsetree
    menhirLib
    uchar
    easy-format))))
